!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("autoIdentify",[],e):"object"==typeof exports?exports.autoIdentify=e():t.autoIdentify=e()}(self,(function(){return(()=>{"use strict";var t={946:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{s(i.next(t))}catch(t){o(t)}}function u(t){try{s(i.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,u)}s((i=i.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(a=0)),a;)try{if(n=1,i&&(r=2&u[0]?i.return:u[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,u[1])).done)return r;switch(i=0,r&&(u=[2&u[0],r.value]),u[0]){case 0:case 1:r=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,i=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!r||u[1]>r[0]&&u[1]<r[3])){a.label=u[1];break}if(6===u[0]&&a.label<r[1]){a.label=r[1],r=u;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(u);break}r[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],i=0}finally{n=r=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=n(894),u=o(n(126)),s=n(37);e.default=function(t,e,n){document.querySelectorAll("form").forEach((function(o){o.addEventListener("submit",(function(){!function(t,e,n,o){i(void 0,void 0,void 0,(function(){var i,c,l,f,d;return r(this,(function(r){switch(r.label){case 0:return i=window.analytics,c=i.identify,l=i.track,window.analytics?(f=(0,a.getEmail)(t.elements))?(d=c,[4,(0,a.getHashOrNull)(n,f)]):[3,4]:[2];case 1:return[4,d.apply(void 0,[r.sent(),{email:f},{integrations:e}])];case 2:return r.sent(),u.default.info('HTMLPlugin -> "identify" -> integrations = '.concat(JSON.stringify(e))),[4,l("form-submit",{version:s.version,scriptId:o},{integrations:e})];case 3:r.sent(),u.default.info('HTMLPlugin -> "track" -> integrations = '.concat(JSON.stringify(e))),r.label=4;case 4:return[2]}}))}))}(o,t,e,n)}))}))}},997:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{s(i.next(t))}catch(t){o(t)}}function u(t){try{s(i.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,u)}s((i=i.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(a=0)),a;)try{if(n=1,i&&(r=2&u[0]?i.return:u[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,u[1])).done)return r;switch(i=0,r&&(u=[2&u[0],r.value]),u[0]){case 0:case 1:r=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,i=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!r||u[1]>r[0]&&u[1]<r[3])){a.label=u[1];break}if(6===u[0]&&a.label<r[1]){a.label=r[1],r=u;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(u);break}r[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],i=0}finally{n=r=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.HubspotPlugin=void 0;var a=n(37),u=n(894),s=o(n(126));e.HubspotPlugin=function(t,e,n,o){return i(void 0,void 0,void 0,(function(){var c,l,f,d,p,h;return r(this,(function(y){return c=window.analytics,l=c.identify,f=c.track,d=t.data,p=d.id,h=d.data,window.analytics?(h.forEach((function(t){var c=t.name,d=t.value;return i(void 0,void 0,void 0,(function(){var t;return r(this,(function(i){switch(i.label){case 0:return"email"!==c?[2]:(t=l,[4,(0,u.getHashOrNull)(n,d)]);case 1:return[4,t.apply(void 0,[i.sent(),{email:d},{integrations:e}])];case 2:return i.sent(),s.default.info('HubspotPlugin -> "identify" -> email = '.concat(d)),[4,f("form-hubspot-submit",{hubspotFormId:p,version:a.version,scriptId:o},{integrations:e})];case 3:return i.sent(),s.default.info('HubspotPlugin -> "track" -> hubspotFormId = '.concat(p)),[2]}}))}))})),[2]):[2]}))}))},e.default=function(t,n,i){window.addEventListener("message",(function(r){var o=r.isTrusted,a=r.data,u=a.type,s=a.eventName;o&&"hsFormCallback"===u&&"onFormSubmit"===s&&(0,e.HubspotPlugin)(r,t,n,i)}))}},928:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{s(i.next(t))}catch(t){o(t)}}function u(t){try{s(i.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,u)}s((i=i.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(a=0)),a;)try{if(n=1,i&&(r=2&u[0]?i.return:u[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,u[1])).done)return r;switch(i=0,r&&(u=[2&u[0],r.value]),u[0]){case 0:case 1:r=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,i=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!r||u[1]>r[0]&&u[1]<r[3])){a.label=u[1];break}if(6===u[0]&&a.label<r[1]){a.label=r[1],r=u;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(u);break}r[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],i=0}finally{n=r=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=n(894),u=o(n(126)),s=n(37);e.default=function(t,e,n){window.addEventListener("message",(function(o){var c=o.data;o.isTrusted&&c&&"dreamdata-message"===c.type&&function(t,e,n,o){i(void 0,void 0,void 0,(function(){var i,c,l,f,d,p,h;return r(this,(function(r){switch(r.label){case 0:return i=window.analytics,c=i.identify,l=i.track,f=t.fields,d=t.formName,window.analytics?(p=(0,a.getEmail)(f))?(h=c,[4,(0,a.getHashOrNull)(n,p)]):[3,4]:[2];case 1:return[4,h.apply(void 0,[r.sent(),{email:p},{integrations:e}])];case 2:return r.sent(),u.default.info('IframePlugin -> form with the name "'.concat(d,'" was submitted')),u.default.info('IframePlugin -> "identify" -> email = '.concat(p)),[4,l(d,{version:s.version,scriptId:o},{integrations:e})];case 3:r.sent(),u.default.info('IframePlugin -> "track" -> integrations = '.concat(JSON.stringify(e))),r.label=4;case 4:return[2]}}))}))}(c,t,e,n)}))}},447:function(t,e,n){var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.IframePlugin=e.HTMLPlugin=e.HubspotPlugin=void 0;var r=n(997);Object.defineProperty(e,"HubspotPlugin",{enumerable:!0,get:function(){return i(r).default}});var o=n(946);Object.defineProperty(e,"HTMLPlugin",{enumerable:!0,get:function(){return i(o).default}});var a=n(928);Object.defineProperty(e,"IframePlugin",{enumerable:!0,get:function(){return i(a).default}})},894:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{s(i.next(t))}catch(t){o(t)}}function u(t){try{s(i.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,u)}s((i=i.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(a=0)),a;)try{if(n=1,i&&(r=2&u[0]?i.return:u[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,u[1])).done)return r;switch(i=0,r&&(u=[2&u[0],r.value]),u[0]){case 0:case 1:r=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,i=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!r||u[1]>r[0]&&u[1]<r[3])){a.label=u[1];break}if(6===u[0]&&a.label<r[1]){a.label=r[1],r=u;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(u);break}r[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],i=0}finally{n=r=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.getEmail=e.idFromEmail=e.getHashOrNull=e.sha1=e.isValidEmail=void 0;var a=o(n(126));e.isValidEmail=function(t){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)};e.sha1=function(t){return i(void 0,void 0,void 0,(function(){var e,n,i,o,u,s,c,l;return r(this,(function(r){switch(r.label){case 0:return e=crypto.subtle,n=t.split(""),i=new Uint8Array(t.length).map((function(t,e){return n[e].charCodeAt(0)})),o=atob("U0hBLTE"),c=(s=Array).from,l=Uint8Array.bind,[4,e.digest(o,i)];case 1:return u=c.apply(s,[new(l.apply(Uint8Array,[void 0,r.sent()]))]).map((function(t){return("00"+t.toString(16)).slice(-2)})).join(""),a.default.info("Input hashed into ".concat(u)),[2,u]}}))}))};e.getHashOrNull=function(t,n){return i(void 0,void 0,void 0,(function(){return r(this,(function(i){switch(i.label){case 0:return t?[4,(0,e.sha1)(n)]:[3,2];case 1:return[2,i.sent()];case 2:return[2,null]}}))}))};e.idFromEmail=function(t,n){return i(void 0,void 0,void 0,(function(){var i,o,u,s,c,l;return r(this,(function(r){switch(r.label){case 0:return i=window.analytics,o=i.identify,u=i.user,s=u().id(),c=u().traits().email,!(0,e.isValidEmail)(c)||s?[3,3]:(a.default.info("User identified with an email: ".concat(c)),l=o,[4,(0,e.getHashOrNull)(!(!n||!c),c)]);case 1:return[4,l.apply(void 0,[r.sent(),{email:c},{integrations:t}])];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))};e.getEmail=function(t){var n=(Array.isArray(t)?t:Array.from(t)).find((function(t){return(0,e.isValidEmail)(t.value)}));return null==n?void 0:n.value}},126:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this.DEBUG_MODE=!!localStorage.getItem("DD_AUTO_IDENTIFY_DEBUG_MODE"),this.DEBUG_MODE&&this.info("ℹ️ DD-AUTO-IDENTIFY DEBUGGER ENABLED")}return t.prototype.print=function(t,e){this.DEBUG_MODE&&Object.prototype.hasOwnProperty.call(console,t)&&console[t](e)},t.prototype.info=function(t){this.print("info","ℹ️ ".concat(t))},t.prototype.error=function(t){this.print("error","❌ ".concat(t))},t.prototype.warn=function(t){this.print("warn","⚠️ ".concat(t))},t}();e.default=new n},37:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.scriptAttributes=e.version=void 0,e.version="1.7.1",e.scriptAttributes={hubspot:"data-hubspot-forms",integrations:"data-integrations",hashIdentify:"data-hash-id",iFrame:"data-iframe",scriptId:"dreamdata-form-identify",iframeScriptId:"dreamdata-iframe",trackFormsByDefault:"data-auto-form"}},607:function(t,e,n){var i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var o=n(447),a=n(37),u=n(894),s=r(n(126)),c=function(){function t(){var t;this.$script=document.getElementById(a.scriptAttributes.scriptId),this.integrations=null===(t=this.$script)||void 0===t?void 0:t.getAttribute(a.scriptAttributes.integrations),this.autoIdentifyOptions={destinations:{all:!1,"Dreamdata IO":!0,"Segment.io":!0},forms:{html:!0,hubspot:!1,iframeForm:!1},shouldHash:!1,identifyFromEmail:!0},window.analytics||s.default.warn("DD Autoidentify -> Analytics library hasn't been loaded. In order to use DD Autoidentify, load the Analytics script first."),this.setAttributes(),this.init()}return t.prototype.setAttributes=function(){window.analytics||s.default.warn('"window.analytics" are not loaded! Stopping execution!'),this.$script?("all"===this.$script.getAttribute(a.scriptAttributes.integrations)&&(s.default.info('setAttributes: Setting "'.concat(a.scriptAttributes.integrations,'" to "all"')),this.setState({destinations:i(i({},this.autoIdentifyOptions.destinations),{all:!0})})),"false"===this.$script.getAttribute(a.scriptAttributes.trackFormsByDefault)&&(s.default.info('setAttributes: Setting "'.concat(a.scriptAttributes.trackFormsByDefault,'" to "false"')),this.setState({forms:i(i({},this.autoIdentifyOptions.forms),{html:!1})})),"true"===this.$script.getAttribute(a.scriptAttributes.hubspot)&&(s.default.info('setAttributes: Setting "'.concat(a.scriptAttributes.hubspot,'" to "true"')),this.setState({forms:i(i({},this.autoIdentifyOptions.forms),{hubspot:!0})})),"true"===this.$script.getAttribute(a.scriptAttributes.iFrame)&&(s.default.info('setAttributes: Setting "'.concat(a.scriptAttributes.iFrame,'" to "true"')),this.setState({forms:i(i({},this.autoIdentifyOptions.forms),{iframeForm:!0})})),"true"===this.$script.getAttribute(a.scriptAttributes.hashIdentify)&&(s.default.info('setAttributes: Setting "'.concat(a.scriptAttributes.hashIdentify,'" to "true"')),this.setState({shouldHash:!0}))):s.default.error('"Cannot set attributes! Script with an id "'.concat(a.scriptAttributes.scriptId,'" was not loaded!'))},t.prototype.init=function(){var t=this.autoIdentifyOptions,e=t.destinations,n=t.forms,i=t.shouldHash;t.identifyFromEmail&&window.analytics.ready((function(){return(0,u.idFromEmail)(e,i)})),n.html&&((0,o.HTMLPlugin)(e,i,a.scriptAttributes.scriptId),s.default.info('init -> forms.html"')),n.iframeForm&&((0,o.IframePlugin)(e,i,a.scriptAttributes.scriptId),s.default.info('init -> forms.iframeForm"')),n.hubspot&&((0,o.HubspotPlugin)(e,i,a.scriptAttributes.scriptId),s.default.info('init -> forms.hubspot"'))},t.prototype.setState=function(t){var e=this;Object.keys(t).forEach((function(n){var r;e.autoIdentifyOptions=i(i({},e.autoIdentifyOptions),((r={})[n]=t[n],r)),s.default.info('Mutating "autoIdentifyOptions", autoIdentifyOptions.'.concat(n," : ").concat(JSON.stringify(t[n])))}))},t}();e.default=c,"loading"===document.readyState?(s.default.info("DOM is ".concat(document.readyState,"...")),document.addEventListener("DOMContentLoaded",(function(){new c,s.default.info("DOMContentLoaded is loaded!")}))):(s.default.info("DOMContentLoaded is already loaded!"),new c)}},e={};var n=function n(i){var r=e[i];if(void 0!==r)return r.exports;var o=e[i]={exports:{}};return t[i].call(o.exports,o,o.exports,n),o.exports}(607);return n=n.default})()}));